#!/usr/bin/env zsh

#-----------------------------------------------------------------------------

[ -r ~/.shrc ] && . ~/.shrc

#-----------------------------------------------------------------------------

ZSH_DATA_HOME=~/.local/share/zsh

#-----------------------------------------------------------------------------

completions=(
  zsh-users/zsh-completions
)

[ "$(uname)" = "Darwin" ] && completions+=(
  nilsonholger/osx-zsh-completions
)

ZSH_COMP_HOME=$ZSH_DATA_HOME/completions
for completion in $completions; do
  if [ ! -d $ZSH_COMP_HOME/${completion#*/} ]; then
    git clone https://github.com/$completion $ZSH_COMP_HOME/${completion#*/}
    ln -sfv $ZSH_COMP_HOME/${completion#*/}/**/_* $ZSH_DATA_HOME/site-functions/
  fi
done
unset completion
unset completions
unset ZSH_COMP_HOME

fpath=($(echo $ZSH_DATA_HOME/site-functions $fpath | xargs -n1 | uniq))
autoload -Uz compinit && compinit -d ~/.cache/zsh/zcompdump

#-----------------------------------------------------------------------------

plugins=(
  zsh-users/zsh-autosuggestions
  zsh-users/zsh-syntax-highlighting
  hlissner/zsh-autopair
)

ZSH_PLUGIN_HOME=$ZSH_DATA_HOME/plugins
for plugin in $plugins; do
  if [ ! -d $ZSH_PLUGIN_HOME/${plugin#*/} ]; then
    git clone https://github.com/$plugin $ZSH_PLUGIN_HOME/${plugin#*/}
  fi
  . $ZSH_PLUGIN_HOME/${plugin#*/}/zsh-*.plugin.zsh
done
unset plugin
unset plugins
unset ZSH_PLUGIN_HOME

#-----------------------------------------------------------------------------

setopt autocd
setopt dotglob
setopt extendedglob
setopt menucomplete #tab completion on first tab hit
setopt chaselinks   #go to actual symlink dir rather in cd
setopt histverify
setopt sharehistory
setopt histappend
setopt incappendhistory
setopt noextendedhistory #no timestamping prepending history entries
setopt nobeep

#-----------------------------------------------------------------------------

bindkey "^H" vi-cmd-mode
bindkey "^K" up-history
bindkey "^J" down-history

#-----------------------------------------------------------------------------

unset ZSH_DATA_HOME
